### é¢„æ¸²æŸ“å‡çº§æˆæœåŠ¡ç«¯æ¸²æŸ“
å›é¡¾é¢„æ¸²æŸ“ æ˜¯åŸºäº `prerender-spa-plugin` åœ¨é¡¹ç›®æ„å»ºæ—¶ï¼Œé€šè¿‡æ— å¤´æµè§ˆå™¨æ¨¡æ‹Ÿæµè§ˆå™¨è¯·æ±‚ï¼Œå°†å¾—åˆ°çš„æ•°æ®æ’å…¥ç»™å‡ºçš„æ¨¡æ¿ä¸­ï¼Œä»è€Œç”Ÿæˆå·²ç»åŒ…å«æ•°æ®çš„htmlï¼ˆ**è¿™é‡Œå…¶å®æœ‰ä¸ªå¤©å‘ï¼Œæœ€åˆå°è¯•é¢„æ¸²æŸ“æ—¶ä¸ºäº†æ–¹ä¾¿ï¼Œä½¿ç”¨webpack-dev-serverçš„proxyé€‰é¡¹åšäº†ä¸€æ¬¡ä»£ç†è¯·æ±‚ä¸‰æ–¹æ¥å£ï¼Œç„¶åé¢„æ¸²æŸ“å¹¶æ²¡æœ‰æ¸²æŸ“å‡ºè¿™äº›åŠ¨æ€çš„æ•°æ®ã€‚åŸå› æ˜¯å› ä¸ºé¢„æ¸²æŸ“çš„æ— å¤´æµè§ˆå™¨å¹¶ä¸ä¼šèµ°dev-serverçš„ä»£ç†ï¼Œå¿…é¡»åœ¨å®¢æˆ·ç«¯å†é…ä¸€å±‚nginxä»£ç†ï¼Œæ‰èƒ½å°†è¯·æ±‚è½¬å‘ï¼Œä»è€Œæ‹¿åˆ°åŠ¨æ€æ•°æ®æ’å…¥æ¨¡æ¿**ï¼‰ã€‚
### SSRå‡çº§ç›¸æ¯”é¢„æ¸²æŸ“å¾—åˆ°äº†ä»€ä¹ˆ
1. æ›´å¿«çš„æ„å»ºé€Ÿåº¦ï¼ŒSSRæ˜¯åŠ¨æ€æ’å…¥æ•°æ®ï¼Œå¹¶ä¸ä¼šåœ¨æ„å»ºæ—¶å°±å»é¢„åŠ è½½æ•°æ®ï¼Œè€Œæ˜¯è¾“å…¥urlååœ¨æœåŠ¡ç«¯è¯·æ±‚ï¼Œæ‹¿åˆ°è¿”å›çš„æ•°æ®æ’å…¥æ¨¡æ¿åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚
2. åµŒå¥—è·¯ç”±ä¸‹çš„ä¸ªæ€§åŒ–é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œä¸ªæ€§åŒ–é¡µé¢æ— æ³•è¿›è¡Œé¢„æ¸²æŸ“ï¼Œssrå´å¯ä»¥è§£å†³ã€‚
3. æ›´å¥½çš„SEOã€‚
4. æ›´å¿«çš„é¦–å±åŠ è½½é€Ÿåº¦ã€‚( è¯·æ±‚ä¸šåŠ¡æ•°æ®ï¼Œå’Œå°†æ•°æ®è½¬ä¸ºhtmlç‰‡æ®µéƒ½åœ¨æœåŠ¡ç«¯è¿›è¡Œäº†ï¼Œæµè§ˆå™¨è´Ÿè´£åŠ è½½èµ„æºï¼Œè¯·æ±‚CDNèµ„æºï¼Œcssæ¸²æŸ“ã€‚åˆ°è¾¾æ—¶é—´ç¼©çŸ­ã€‚ä¹‹åèµ°çš„ä¾æ—§æ˜¯å‰ç«¯è·¯ç”±ï¼Œç„¶åå‰ç«¯é¢„å–æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œä»…ä»…é¦–å± )ã€‚

### å®˜æ–¹æµç¨‹å›¾
![ssræµç¨‹](https://upload-images.jianshu.io/upload_images/6870041-e473305275cf3b25.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### å®˜æ–¹demo
[HackerNews Demo](https://github.com/vuejs/vue-hackernews-2.0/)
### å‡çº§è¦åšå“ªäº›å¤„ç†
##### ä¸€ï¼Œä½¿ç”¨SSRï¼Œåç«¯æŒæ¡æƒåº”åœ¨è‡ªå·±æ‰‹é‡Œï¼Œå…·ä½“å¦‚ä½•å®ç°çƒ­æ›´æ–°ï¼Œæ˜¯åé¢çš„äº‹ã€‚server.jsåšäº†ä»€ä¹ˆã€‚
**æœåŠ¡ç«¯æ•°æ®å¿…é¡»ä¸å®¢æˆ·ç«¯æ•°æ®ä¿æŒä¸€è‡´ï¼Œå¼•å…¥Vuex**
1. expressç”Ÿæˆä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ã€‚
2. å®¢æˆ·ç«¯ä½¿ç”¨æ‰“åŒ…å¥½çš„index.htmlï¼Œå› ä¸ºä¹‹åè¿˜æ˜¯è¦èµ°å‰ç«¯è·¯ç”±ï¼Œè¿™ä¸ªç”±`html-webpack-plugin`ç”Ÿæˆå¥½çš„æ³¨å…¥äº†å‰ç«¯æ‰“åŒ…å¥½çš„è„šæœ¬çš„htmléœ€è¦ä½œä¸ºrendererçš„æ¨¡æ¿ã€‚
3. æœåŠ¡ç«¯entry-server.jsæ‰“åŒ…å¥½çš„å…¥å£ä¼ å…¥createBundleRendererï¼Œè¿™é‡Œäº§å‡ºçš„æ˜¯é¦–å±htmlçš„ä¸»ä½“éƒ¨åˆ†ã€‚
4. é€šè¿‡2ï¼Œ3`vue-server-renderer`ä¼šå°†å®ƒä»¬æ‹¼åˆæˆä¸€ä¸ªæ•´ä½“ï¼Œå†ä¼ è‡³å‰ç«¯ã€‚
##### äºŒï¼Œæ‰“åŒ…
**æ‰“åŒ…åˆ†ä¸ºå®¢æˆ·ç«¯æ–‡ä»¶çš„æ‰“åŒ…å’ŒæœåŠ¡ç«¯æ–‡ä»¶çš„æ‰“åŒ…ã€‚å°†å…¬ç”¨çš„éƒ¨åˆ†åˆ†ç¦»åˆ°`webpack.base.config.js`ã€‚åˆå¹¶å¯ä»¥é€šè¿‡webpack-mergeæˆ–è€…ç®€å•åœ°é€šè¿‡Object.assignç»„åˆä¸¤ç§configã€‚**
1. å®¢æˆ·ç«¯æ‰“åŒ…æ–‡ä»¶ä¸æ­£å¸¸SPAçš„æ‰“åŒ…æ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå…¥å£ä¸ºentry-client.jsã€‚
2. æœåŠ¡ç«¯æ‰“åŒ…æ–‡ä»¶æ³¨æ„æŒ‡å®šæ‰§è¡Œç¯å¢ƒä¸ºnodeï¼Œæ‰“åŒ…ä½¿ç”¨commonjsè§„èŒƒï¼Œå› ä¸ºä¹‹åè¦åœ¨æœåŠ¡ç«¯è·‘çš„å‘€ï¼Œå…¥å£ä¸ºentry-server.jsã€‚
3. `webpack.base.config`ä¹Ÿæ²¡ä»€ä¹ˆï¼Œé»˜è®¤entryä¸ºentry-client.jsã€‚webpack4ä»¥ä¸Šè®°å¾—æŒ‡å®šæ‰“åŒ…æ¨¡å¼ã€‚
##### ä¸‰ï¼Œå…¥å£`entry-server.js&&entry-client.js`
1. æœåŠ¡ç«¯å…¥å£é€šè¿‡app.vueå¯¼å‡ºçš„createAppç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
2. ä¼ å…¥æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„urlï¼Œä»¥æ­¤åŒ¹é…å¯¹åº”çš„æ‰€æœ‰ç»„ä»¶ï¼Œå¾ªç¯æ‰§è¡Œæ‰€æœ‰åŒ¹é…åˆ°ç»„ä»¶ä¸­çš„asyncData()å³æ‰€éœ€è·å–çš„å¼‚æ­¥æ•°æ®ã€‚è·å–çš„æ•°æ®å­˜å‚¨åœ¨store.stateä¸­ã€‚
3. æ‰§è¡Œå®Œæ¯•åï¼Œå°†store.stateæ³¨å…¥contextï¼ˆä¹‹åå®¢æˆ·ç«¯å…¥å£å¯ä»¥é€šè¿‡window.__INITIAL_STATE__ï¼‰è·å–åˆ°è¿™ä¸ªå·²ç»å…¨éƒ¨è·å–è¿‡çš„store.stateï¼Œä»¥æ­¤ä¿æŒæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚**æ­¤å¤„è‹¥å‡ºé”™ä¼šå¯¼è‡´æ··åˆå¤±è´¥ï¼ŒæœåŠ¡ç«¯æ•°æ®è¢«è¦†ç›–ã€‚æµè§ˆå™¨ç”¨å®¢æˆ·ç«¯çš„æ•°æ®é‡æ–°æ¸²æŸ“**
4. å®¢æˆ·ç«¯å…¥å£é€šè¿‡app.vueå¯¼å‡ºçš„createAppç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
5. å°†window.__INITIAL_STATE__æ³¨å…¥storeã€‚
6. ä¹‹åèµ°å‰ç«¯è·¯ç”±ï¼ŒasyncData()ä¸­é¢„å–çš„æ“ä½œåœ¨æœåŠ¡ç«¯å·²ä¸å†æ‰§è¡Œï¼Œæ‰€ä»¥æ­¤æ—¶å‰ç«¯é¢„å–ã€‚é€šè¿‡`router.beforeResolve((to, from, next)=>{})`åŒ¹é…è·¯ç”±å¹¶é¢„å–æ•°æ®ã€‚ï¼ˆæ³¨æ„ï¼Œåœ¨åŒä¸€åµŒå¥—è·¯ç”±ä¸‹çš„ç»„ä»¶çš„æ•°æ®ä¸è¦å†é‡æ–°è·å–äº†ï¼Œdiffå®ç°ï¼‰ã€‚
7. é¢„å–å®Œæ¯•åï¼Œå°†è¯¥å®ä¾‹æŒ‚è½½åˆ°æ ¹ç»„ä»¶ã€‚
##### å››ï¼Œå‰ç«¯å…¥å£æ–‡ä»¶src/index.js
ä»ä»¥ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œindex.jså¿…é¡»ä½œä¸ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå¯¼å‡ºä¸€ä¸ªç”Ÿæˆvueå®ä¾‹çš„å‡½æ•°ï¼Œå¹¶ä¸”åŒ…å«storeï¼Œrouterè¿™äº›åœ¨å…¥å£ä¸­ä½¿ç”¨åˆ°çš„å®ä¾‹ã€‚
##### äº”ï¼Œçƒ­æ›´æ–°åšäº†ä»€ä¹ˆï¼Ÿ
**setup-dev-server.jså¯¼å‡ºä¸€ä¸ªæ¥æ”¶expresså®ä¾‹å’Œå¤„ç†index.htmlå’Œserver-bundle.jsçš„å‡½æ•°ã€‚**
1. å¼€å‘æ¨¡å¼ä¸‹ï¼Œä¾èµ–`webpack-dev-middleware`æ‰§è¡Œä»£ç ç›‘å¬å¹¶çƒ­æ›´æ–°æ‰“åŒ…ï¼Œä¾èµ–`webpack-hot-middleware`æ‰§è¡Œé¡µé¢çƒ­æ›´æ–°ã€‚
2. å¯¼å‡ºå†…å­˜ä¸­çš„æ‰“åŒ…å¥½çš„index.htmlå’Œserver-bundle.jsã€‚***åœ¨server.jså…¥å£ï¼Œé€šè¿‡vue-server-rendereræ•´åˆæ¨¡æ¿å’ŒæœåŠ¡ç«¯å…¥å£ã€‚***
### å®˜æ–¹æ–‡æ¡£ï¼Œå¾ˆå¤šåœ°æ–¹å€¼å¾—æ·±ç©¶å’Œç»†ç»†æ¨ç©¶ï¼Œå†™äº†ä¸ªå°demoä¾¿äºå­¦ä¹ å§ã€‚
> å¦‚æœä½ ä¾èµ–ç”±ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å¡«å……çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œåˆ™ä¸å»ºè®®ä½¿ç”¨æµå¼ä¼ è¾“æ¨¡å¼ã€‚ğŸ˜‚ğŸ˜‚ğŸ˜‚
##### ç›´æ¥renderToString [å¸¦æ³¨é‡Šå°demoğŸ˜³](https://github.com/chentianyuan/prerender)
